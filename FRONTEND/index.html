<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Indicateurs √âcologiques</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>üåø Indicateurs √âcologiques</h1>
        
        <div class="search-box">
            <input type="text" id="commune" placeholder="Nom de la commune">
            <button onclick="rechercher()">Rechercher</button>
        </div>
        
        <div id="resultats"></div>
    </div>

    <script>
        async function rechercher() {
            const commune = document.getElementById('commune').value;
            const div = document.getElementById('resultats');
            
            if (!commune) return;
            div.innerHTML = 'Chargement...';
            
            try {
                const res = await fetch(`http://127.0.0.1:8000/indicateurs?commune=${commune}`);
                const json = await res.json();
                let html = `<h2>R√©sultats pour ${commune}</h2>`;
                
                // √ânergie
                html += '<h3>‚ö° Consommation √ânergie</h3>';
                if (json.energie && json.energie.length > 0) {
                    html += '<table><tr><th>Commune</th><th>Ann√©e</th><th>Valeur</th></tr>';
                    json.energie.forEach(row => {
                        const val = parseFloat(row['conso_enaf_com.id_611']) || 0;
                        html += `<tr><td>${row['conso_enaf_com.libelle_commune']}</td><td>${row['conso_enaf_com.annee']}</td><td>${val.toFixed(2)}</td></tr>`;
                    });
                    html += '</table>';
                } else {
                    html += '<p>Pas de donn√©es</p>';
                }
                
                // Eau
                html += '<h3>üíß Pr√©l√®vement Eau</h3>';
                if (json.eau && json.eau.length > 0) {
                    html += '<table><tr><th>Commune</th><th>Ann√©e</th><th>Valeur</th></tr>';
                    json.eau.forEach(row => {
                        const val = parseFloat(row['prelevement_eau_usage_com.id_638']) || 0;
                        html += `<tr><td>${row['prelevement_eau_usage_com.libelle_commune']}</td><td>${row['prelevement_eau_usage_com.annee']}</td><td>${val.toFixed(0)}</td></tr>`;
                    });
                    html += '</table>';
                } else {
                    html += '<p>Pas de donn√©es</p>';
                }
                
                div.innerHTML = html;
            } catch (e) {
                div.innerHTML = '<p>Erreur de connexion √† l\'API</p>';
            }
        }
        
        document.getElementById('commune').addEventListener('keypress', e => {
            if (e.key === 'Enter') rechercher();
        });
    </script>
</body>
</html>


